<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MovieExplorer.Pages.MoviesPage"
             Title="Movies">

    <!-- Grid with 3 rows: Search bar, Buttons, Movie list -->
    <Grid RowDefinitions="Auto,Auto,*" Padding="10">

        <!-- Row 0: Search Bar -->
        <SearchBar x:Name="SearchBar" 
                   Grid.Row="0"
                   Placeholder="Search movies by title or genre..."
                   TextChanged="OnSearchTextChanged"
                   Margin="5"/>

        <!-- Row 1: Filter Buttons -->
        <HorizontalStackLayout Grid.Row="1" Spacing="10" Margin="5" HorizontalOptions="Center">
            <Button Text="All Movies" Clicked="OnShowAllClicked"/>
            <Button Text="Sort by Year" Clicked="OnSortByYearClicked"/>
            <Button Text="Sort by Rating" Clicked="OnSortByRatingClicked"/>
        </HorizontalStackLayout>

        <!-- Row 2: Movies List -->
        <CollectionView x:Name="MoviesCollectionView" 
                        Grid.Row="2"
                        SelectionMode="Single"
                        SelectionChanged="OnMovieSelected">

            <!-- How each movie looks in the list -->
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <!-- Frame = rounded box with shadow -->
                    <Frame Padding="15" Margin="5" CornerRadius="10" HasShadow="True">
                        <!-- Grid for layout: emoji on left, info on right -->
                        <Grid ColumnDefinitions="60,*,Auto" RowDefinitions="Auto,Auto,Auto">

                            <!-- Emoji (spans all 3 rows) -->
                            <Label Grid.Column="0" Grid.RowSpan="3"
                                   Text="{Binding Emoji}" 
                                   FontSize="48"
                                   VerticalOptions="Center"
                                   HorizontalOptions="Center"/>

                            <!-- Movie Title -->
                            <Label Grid.Column="1" Grid.Row="0"
                                   Text="{Binding Title}" 
                                   FontSize="18" 
                                   FontAttributes="Bold"
                                   Margin="10,0,0,0"/>

                            <!-- Year and Rating -->
                            <Label Grid.Column="1" Grid.Row="1"
                                   FontSize="14" 
                                   Margin="10,5,0,0">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding Year}" FontAttributes="Bold"/>
                                        <Span Text=" | ⭐ "/>
                                        <Span Text="{Binding ImdbRating}"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>

                            <!-- Genres -->
                            <Label Grid.Column="1" Grid.Row="2"
                                   Text="{Binding GenresString}" 
                                   FontSize="12" 
                                   TextColor="Gray"
                                   Margin="10,5,0,0"/>

                            <!-- Arrow Icon -->
                            <Label Grid.Column="2" Grid.RowSpan="3"
                                   Text="▶" 
                                   FontSize="20"
                                   VerticalOptions="Center"
                                   TextColor="Gray"/>

                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Loading spinner (shown while downloading) -->
        <ActivityIndicator x:Name="LoadingIndicator" 
                          Grid.Row="2"
                          IsRunning="False"
                          IsVisible="False"
                          Color="Blue"
                          VerticalOptions="Center"
                          HorizontalOptions="Center"/>

    </Grid>

</ContentPage>