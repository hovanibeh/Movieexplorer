<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MovieExplorer.Pages.MoviesPage"
             Title="Movies">

    <Grid RowDefinitions="Auto,Auto,*" Padding="10">

        <!-- Row 0: Search Bar -->
        <SearchBar x:Name="SearchBar" 
                   Grid.Row="0"
                   Placeholder="Search movies by title or genre..."
                   TextChanged="OnSearchTextChanged"
                   Margin="5"/>

        <!-- Row 1: Filter Buttons -->
        <HorizontalStackLayout Grid.Row="1" Spacing="10" Margin="5" HorizontalOptions="Center">
            <Button Text="All Movies" Clicked="OnShowAllClicked"/>
            <Button Text="Sort by Year" Clicked="OnSortByYearClicked"/>
            <Button Text="Sort by Rating" Clicked="OnSortByRatingClicked"/>
        </HorizontalStackLayout>

        <!-- Row 2: Movies List -->
        <CollectionView x:Name="MoviesCollectionView" 
                        Grid.Row="2"
                        SelectionMode="Single"
                        SelectionChanged="OnMovieSelected">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border Padding="15" Margin="5" StrokeThickness="1" Stroke="Gray" BackgroundColor="White">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="10"/>
                        </Border.StrokeShape>

                        <Grid ColumnDefinitions="60,*,Auto" RowDefinitions="Auto,Auto,Auto">

                            <!-- Emoji -->
                            <Label Grid.Column="0" Grid.RowSpan="3"
                                   Text="{Binding Emoji}" 
                                   FontSize="48"
                                   VerticalOptions="Center"
                                   HorizontalOptions="Center"/>

                            <!-- Movie Title - BLACK TEXT -->
                            <Label Grid.Column="1" Grid.Row="0"
                                   Text="{Binding Title}" 
                                   FontSize="18" 
                                   FontAttributes="Bold"
                                   TextColor="Black"
                                   Margin="10,0,0,0"/>

                            <!-- Year and Rating - BLACK TEXT -->
                            <Label Grid.Column="1" Grid.Row="1"
                                   FontSize="14" 
                                   Margin="10,5,0,0">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding Year}" FontAttributes="Bold" TextColor="Black"/>
                                        <Span Text=" | ⭐ " TextColor="Black"/>
                                        <Span Text="{Binding ImdbRating}" TextColor="Black"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>

                            <!-- Genres - GREY TEXT -->
                            <Label Grid.Column="1" Grid.Row="2"
                                   Text="{Binding GenresString}" 
                                   FontSize="12"
                                   TextColor="#666666"
                                   Margin="10,5,0,0"/>

                            <!-- Arrow -->
                            <Label Grid.Column="2" Grid.RowSpan="3"
                                   Text="▶" 
                                   FontSize="20"
                                   TextColor="Gray"
                                   VerticalOptions="Center"/>

                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Loading spinner -->
        <ActivityIndicator x:Name="LoadingIndicator" 
                          Grid.Row="2"
                          IsRunning="False"
                          IsVisible="False"
                          Color="Blue"
                          VerticalOptions="Center"
                          HorizontalOptions="Center"/>

    </Grid>

</ContentPage>